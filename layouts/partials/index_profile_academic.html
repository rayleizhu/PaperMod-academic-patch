<div class="academic-home">
  <div id="profile" class="home-header">
    <div class="profile-content">
      {{- if site.Params.profileMode.imageUrl }}
      <div class="profile-image">
        {{- $img := "" }}
        {{- if not (urls.Parse site.Params.profileMode.imageUrl).IsAbs }}
            {{- $img = resources.Get site.Params.profileMode.imageUrl }}
        {{- end }}
        {{- if $img }}
            {{- $processableFormats := (slice "jpg" "jpeg" "png" "tif" "bmp" "gif") -}}
            {{- if hugo.IsExtended -}}
                {{- $processableFormats = $processableFormats | append "webp" -}}
            {{- end -}}
            {{- $prod := (hugo.IsProduction | or (eq site.Params.env "production")) }}
            {{- if and (in $processableFormats $img.MediaType.SubType) (eq $prod true)}}
                {{- if (not (and (not site.Params.profileMode.imageHeight) (not site.Params.profileMode.imageWidth))) }}
                    {{- $img = $img.Resize (printf "%dx%d" (mul site.Params.profileMode.imageWidth 3) (mul site.Params.profileMode.imageHeight 3)) }}
                {{- else if site.Params.profileMode.imageHeight }}
                    {{- $img = $img.Resize (printf "x%d" (mul site.Params.profileMode.imageHeight 3)) }}
                {{ else if site.Params.profileMode.imageWidth }}
                    {{- $img = $img.Resize (printf "%dx" (mul site.Params.profileMode.imageWidth 3)) }}
                {{ else }}
                    {{- $img = $img.Resize "600x600" }}
                {{- end }}
            {{- end }}
            <img draggable="false" src="{{ $img.Permalink }}" alt="{{ site.Params.profileMode.imageTitle | default "profile image" }}" title="{{ site.Params.profileMode.imageTitle }}"
                height="{{ site.Params.profileMode.imageHeight | default 200 }}" width="{{ site.Params.profileMode.imageWidth | default 200 }}" />
        {{- else }}
        <img draggable="false" src="{{ site.Params.profileMode.imageUrl | absURL }}" alt="{{ site.Params.profileMode.imageTitle | default "profile image" }}" title="{{ site.Params.profileMode.imageTitle }}"
            height="{{ site.Params.profileMode.imageHeight | default 200 }}" width="{{ site.Params.profileMode.imageWidth | default 200 }}" />
        {{- end }}
      </div>
      {{- end }}
      
      <div class="profile-info">
        <h1 class="profile-name">{{ site.Params.profileMode.title | default site.Title | markdownify }}</h1>
        {{- if site.Params.profileMode.subtitle }}
        <h2 class="profile-position">{{ site.Params.profileMode.subtitle | markdownify }}</h2>
        {{- end }}
        {{- if site.Params.profileMode.affiliation }}
        <h3 class="profile-affiliation">{{ site.Params.profileMode.affiliation | markdownify }}</h3>
        {{- end }}
        {{- if site.Params.profileMode.email }}
        <p class="profile-email">
          <a href="mailto:{{ site.Params.profileMode.email }}">{{ site.Params.profileMode.email }}</a>
        </p>
        {{- end }}
        {{- partial "social_icons.html" (dict) -}}
      </div>
    </div>
    <div class="mobile-social">
      {{- partial "social_icons.html" (dict) -}}
    </div>
  </div>

  <div class="content-wrapper">
    <div class="main-content">

  {{- $about := site.GetPage "about" }}
  {{- if $about }}
  <section id="about" class="home-section">
    <h2>About Me</h2>
    <div class="about-content">
      {{- if not ($about.Param "disableAnchoredHeadings") }}
      {{- partial "anchored_headings.html" $about.Content -}}
      {{- else }}{{ $about.Content }}{{ end }}
    </div>
  </section>
  {{- end }}

  {{- $pubsPage := site.GetPage "pubs" }}
  {{- $pubs := $pubsPage.Pages }}
  {{- $selectedPubs := where $pubs "Params.selected" true }}
  {{- if $selectedPubs }}
  <section id="publications" class="home-section">
    <h2>Selected Publications
      {{- if $pubsPage }}<a href="{{ $pubsPage.Permalink }}" class="full-list-link">[Full List]</a>{{- end }}
      {{- range site.Params.socialIcons }}
        {{- if eq .name "googlescholar" }}<a href="{{ .url }}" target="_blank" class="full-list-link">[Google Scholar]</a>{{- end }}
      {{- end }}
    </h2>
    <div class="publications-legend" style="font-size: 0.8rem; margin-bottom: 0.3rem; text-align: left;">
      * Equal contribution; <sup>âœ‰</sup> Corresponding author
    </div>
    <div class="home-list">
      {{- range $selectedPubs }}
      {{- partial "publication_item.html" (dict "page" . "show_preview" true "show_description" true "show_links" true) -}}
      {{- end }}
    </div>
  </section>
  {{- end }}

  {{- $newsPage := site.GetPage "news" }}
  {{- $news := $newsPage.Pages }}
  {{- if $news }}
  <section id="news" class="home-section">
    <h2>Latest News</h2>
    <div class="home-list">
      {{- range first 5 $news }}
      <div class="home-item">
        <span class="news-date">{{ .Date.Format "2006-01-02" }}</span>
        <span class="news-content">{{ .Summary }}</span>
      </div>
      {{- end }}
    </div>
  </section>
  {{- end }}

  {{- if site.Params.profileMode.experience }}
  <section id="experience" class="home-section">
    <h2>Experience</h2>
    <div class="home-list">
      {{- range site.Params.profileMode.experience }}
      <div class="home-item">
        <div class="experience-details">
          {{- if .description }}
          <p class="experience-description">{{ .description | markdownify }}</p>
          {{- end }}
        </div>
        <div class="experience-period">{{ .period }}</div>
      </div>
      {{- end }}
    </div>
  </section>
  {{- end }}

  {{- if site.Params.profileMode.awards }}
  <section id="awards" class="home-section">
    <h2>Selected Awards</h2>
    <div class="home-list">
      {{- range site.Params.profileMode.awards }}
      <div class="home-item">
        <span class="award-year">{{ .year }}</span>
        <span class="award-name">{{ .name }}</span>
        {{- if .organization }}
        <span class="award-organization">{{ .organization }}</span>
        {{- end }}
      </div>
      {{- end }}
    </div>
  </section>
  {{- end }}

    </div>
    {{- if site.Params.profileMode.showToc }}
    <aside class="toc-sidebar">
      <div class="toc-container">
        <h3 class="toc-title">Table of Contents</h3>
        <ul class="toc-list">
          {{- if site.GetPage "about" }}
          <li><a href="#about">About Me</a></li>
          {{- end }}
          {{- if (site.GetPage "news").Pages }}
          <li><a href="#news">Latest News</a></li>
          {{- end }}
          {{- if where (site.GetPage "pubs").Pages "Params.selected" true }}
          <li><a href="#publications">Selected Publications</a></li>
          {{- end }}
          {{- if site.Params.profileMode.experience }}
          <li><a href="#experience">Experience</a></li>
          {{- end }}
          {{- if site.Params.profileMode.awards }}
          <li><a href="#awards">Awards & Honors</a></li>
          {{- end }}
        </ul>
      </div>
    </aside>
    {{- end }}
  </div>
</div>
